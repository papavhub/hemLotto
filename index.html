<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="manifest" href="manifest.json">
<title>LOTTO GENERATOR</title>

<style>
body{
  margin:0;
  background:radial-gradient(circle at 20% 20%, #1e293b, #0f172a 60%);
  color:white;
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  text-align:center;
  min-height:100vh;
}

h1{
  margin-top:60px;
  font-weight:600;
  letter-spacing:2px;
}

/* ÌÜ†Í∏Ä */
.toggle-wrap{
  margin:40px auto;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  font-size:14px;
  opacity:.9;
}

.switch{
  position:relative;
  width:64px;
  height:30px;
}
.switch input{opacity:0;width:0;height:0;}
.slider{
  position:absolute;
  inset:0;
  background:#334155;
  border-radius:30px;
  transition:.3s;
}
.slider:before{
  content:"";
  position:absolute;
  height:22px;
  width:22px;
  left:4px;
  bottom:4px;
  background:white;
  border-radius:50%;
  transition:.3s;
}
input:checked + .slider{background:#6366f1;}
input:checked + .slider:before{transform:translateX(34px);}

/* Î≤àÌò∏ */
.numbers{
  margin-top:60px;
  display:flex;
  justify-content:center;
  gap:22px;
  flex-wrap:wrap;
}
.ball{
  width:72px;
  height:72px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  font-weight:700;
  color:white;
}
.ball.final{
  animation:pop .35s ease;
}
@keyframes pop{
  0%{transform:scale(1.2);}
  100%{transform:scale(1);}
}

/* Î≤ÑÌäº */
.main-btn{
  margin-top:60px;
  padding:14px 44px;
  border:none;
  border-radius:40px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(45deg,#6366f1,#8b5cf6);
  color:white;
}
.main-btn:disabled{opacity:.4;cursor:not-allowed;}

.action-row{
  margin-top:30px;
  display:none;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
}

.action-row button{
  padding:10px 18px;
  border:none;
  border-radius:20px;
  font-size:14px;
  cursor:pointer;
  background:#334155;
  color:white;
}

.install-btn{
  margin-top:20px;
  background:#111827;
  padding:10px 22px;
  border-radius:30px;
  font-size:14px;
  border:1px solid #374151;
  cursor:pointer;
}

@media(max-width:480px){
  .ball{width:60px;height:60px;font-size:22px;}
}
</style>
</head>
<body>

<h1>LOTTO GENERATOR</h1>

<div class="toggle-wrap">
  <span>ÌïòÎÇòÏî© Î≥¥Í∏∞</span>
  <label class="switch">
    <input type="checkbox" id="modeToggle">
    <span class="slider"></span>
  </label>
  <span>ÌïúÎ≤àÏóê Î≥¥Í∏∞</span>
</div>

<div class="numbers" id="numbers"></div>

<button class="main-btn" id="generateBtn">Î≤àÌò∏ ÏÉùÏÑ±</button>

<div class="action-row" id="actionRow">
  <button onclick="copyNumbers()">Î≤àÌò∏ Î≥µÏÇ¨</button>
  <button onclick="shareNumbers()">Í≥µÏú†</button>
  <button onclick="saveImage()">ÏÇ¨ÏßÑ Ï†ÄÏû•</button>
</div>

<button class="install-btn">Ïï± ÏÑ§Ïπò</button>

<script>
const numbersContainer=document.getElementById("numbers");
const generateBtn=document.getElementById("generateBtn");
const modeToggle=document.getElementById("modeToggle");
const actionRow=document.getElementById("actionRow");

let currentNumbers=[];

function getColor(num){
  if(num<=10) return "#facc15";
  if(num<=20) return "#3b82f6";
  if(num<=30) return "#ef4444";
  if(num<=40) return "#22c55e";
  return "#a855f7";
}

function generateNumbers(){
  const set=new Set();
  while(set.size<6){
    set.add(Math.floor(Math.random()*45)+1);
  }
  return [...set];
}

function spinBall(ball, finalNumber, duration=1200){
  return new Promise(resolve=>{
    let elapsed=0;
    const interval=60;

    const spin=setInterval(()=>{
      const randomNum=Math.floor(Math.random()*45)+1;
      ball.textContent=randomNum;
      ball.style.background=getColor(randomNum);
      elapsed+=interval;

      if(elapsed>=duration){
        clearInterval(spin);
        ball.textContent=finalNumber;
        ball.style.background=getColor(finalNumber);
        ball.classList.add("final");
        resolve();
      }
    },interval);
  });
}

async function sequentialMode(sorted){
  for(let i=0;i<6;i++){
    const ball=document.createElement("div");
    ball.className="ball";
    numbersContainer.appendChild(ball);
    await spinBall(ball,sorted[i],1000);
  }
}

async function allAtOnceMode(sorted){
  const balls=[];
  for(let i=0;i<6;i++){
    const ball=document.createElement("div");
    ball.className="ball";
    numbersContainer.appendChild(ball);
    balls.push(ball);
  }
  await Promise.all(
    balls.map((ball,i)=>spinBall(ball,sorted[i],1200))
  );
}

generateBtn.addEventListener("click", async()=>{
  generateBtn.disabled=true;
  actionRow.style.display="none";
  numbersContainer.innerHTML="";

  const numbers=generateNumbers();
  const sorted=[...numbers].sort((a,b)=>a-b);
  currentNumbers=sorted;

  if(modeToggle.checked){
    await allAtOnceMode(sorted);
  }else{
    await sequentialMode(sorted);
  }

  actionRow.style.display="flex";
  generateBtn.disabled=false;
});

/* Î≥µÏÇ¨ */
function copyNumbers(){
  navigator.clipboard.writeText(currentNumbers.join(", "));
  alert("Î≥µÏÇ¨ ÏôÑÎ£å!");
}

/* Í≥µÏú† */
function shareNumbers(){
  if(navigator.share){
    navigator.share({
      title:"Î°úÎòê Î≤àÌò∏",
      text:currentNumbers.join(", ")
    });
  }else{
    alert("Ïù¥ Î∏åÎùºÏö∞Ï†ÄÎäî Í≥µÏú†Î•º ÏßÄÏõêÌïòÏßÄ ÏïäÏäµÎãàÎã§.");
  }
}

/* Ïù¥ÎØ∏ÏßÄ Ï†ÄÏû• (Ïà´Ïûê 6Í∞úÎßå) */
function saveImage(){
  const canvas=document.createElement("canvas");
  canvas.width=600;
  canvas.height=200;
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="#0f172a";
  ctx.fillRect(0,0,600,200);

  currentNumbers.forEach((num,i)=>{
    ctx.beginPath();
    ctx.arc(80+i*90,100,35,0,Math.PI*2);
    ctx.fillStyle=getColor(num);
    ctx.fill();
    ctx.fillStyle="white";
    ctx.font="20px sans-serif";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(num,80+i*90,100);
  });

  const link=document.createElement("a");
  link.download="lotto.png";
  link.href=canvas.toDataURL();
  link.click();
}

let deferredPrompt;
const installBtn = document.querySelector(".install-btn");

/* ÏïàÎìúÎ°úÏù¥Îìú ÏÑ§Ïπò Ïù¥Î≤§Ìä∏ Í∞êÏßÄ */
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
});

/* Î≤ÑÌäº ÌÅ¥Î¶≠ */
installBtn.addEventListener("click", async () => {

  const ua = navigator.userAgent.toLowerCase();

  // üì± iPhone Ï≤òÎ¶¨
  if (ua.includes("iphone") || ua.includes("ipad")) {
    alert("üì≤ ÏïÑÏù¥Ìè∞ÏùÄ SafariÏóêÏÑú Í≥µÏú† Î≤ÑÌäº ‚Üí 'Ìôà ÌôîÎ©¥Ïóê Ï∂îÍ∞Ä'Î•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.");
    return;
  }

  // ü§ñ ÏïàÎìúÎ°úÏù¥Îìú
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const choiceResult = await deferredPrompt.userChoice;

    if (choiceResult.outcome === "accepted") {
      console.log("ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÑ§ÏπòÎ•º ÏàòÎùΩÌñàÏäµÎãàÎã§");
    }

    deferredPrompt = null;
  } else {
    alert("Ïù¥ÎØ∏ ÏÑ§ÏπòÎêòÏóàÍ±∞ÎÇò ÏÑ§ÏπòÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÎäî ÌôòÍ≤ΩÏûÖÎãàÎã§.");
  }
});

  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("service-worker.js")
        .then(() => console.log("Service Worker Îì±Î°ù ÏôÑÎ£å"))
        .catch(err => console.log("Service Worker Îì±Î°ù Ïã§Ìå®:", err));
    });
  }

</script>

</body>
</html>
