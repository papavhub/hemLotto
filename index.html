<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LOTTO GENERATOR</title>

<style>
body{
  margin:0;
  background:radial-gradient(circle at 20% 20%, #1e293b, #0f172a 60%);
  color:white;
  font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
  text-align:center;
  min-height:100vh;
}

h1{
  margin-top:60px;
  font-weight:600;
  letter-spacing:2px;
}

/* í† ê¸€ */
.toggle-wrap{
  margin:40px auto;
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  font-size:14px;
  opacity:.9;
}

.switch{
  position:relative;
  width:64px;
  height:30px;
}
.switch input{opacity:0;width:0;height:0;}
.slider{
  position:absolute;
  inset:0;
  background:#334155;
  border-radius:30px;
  transition:.3s;
}
.slider:before{
  content:"";
  position:absolute;
  height:22px;
  width:22px;
  left:4px;
  bottom:4px;
  background:white;
  border-radius:50%;
  transition:.3s;
}
input:checked + .slider{background:#6366f1;}
input:checked + .slider:before{transform:translateX(34px);}

/* ë²ˆí˜¸ */
.numbers{
  margin-top:60px;
  display:flex;
  justify-content:center;
  gap:22px;
  flex-wrap:wrap;
}
.ball{
  width:72px;
  height:72px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:26px;
  font-weight:700;
  color:white;
}
.ball.final{
  animation:pop .35s ease;
}
@keyframes pop{
  0%{transform:scale(1.2);}
  100%{transform:scale(1);}
}

/* ë²„íŠ¼ */
.main-btn{
  margin-top:60px;
  padding:14px 44px;
  border:none;
  border-radius:40px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(45deg,#6366f1,#8b5cf6);
  color:white;
}
.main-btn:disabled{opacity:.4;cursor:not-allowed;}

.action-row{
  margin-top:30px;
  display:none;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
}

.action-row button{
  padding:10px 18px;
  border:none;
  border-radius:20px;
  font-size:14px;
  cursor:pointer;
  background:#334155;
  color:white;
}

.install-btn{
  margin-top:20px;
  background:#111827;
  padding:10px 22px;
  border-radius:30px;
  font-size:14px;
  border:1px solid #374151;
  cursor:pointer;
}

@media(max-width:480px){
  .ball{width:60px;height:60px;font-size:22px;}
}
</style>
</head>
<body>

<h1>LOTTO GENERATOR</h1>

<div class="toggle-wrap">
  <span>í•˜ë‚˜ì”© ë³´ê¸°</span>
  <label class="switch">
    <input type="checkbox" id="modeToggle">
    <span class="slider"></span>
  </label>
  <span>í•œë²ˆì— ë³´ê¸°</span>
</div>

<div class="numbers" id="numbers"></div>

<button class="main-btn" id="generateBtn">ë²ˆí˜¸ ìƒì„±</button>

<div class="action-row" id="actionRow">
  <button onclick="copyNumbers()">ë²ˆí˜¸ ë³µì‚¬</button>
  <button onclick="shareNumbers()">ê³µìœ </button>
  <button onclick="saveImage()">ì‚¬ì§„ ì €ì¥</button>
</div>

<button class="install-btn">ì•± ì„¤ì¹˜</button>

<script>
const numbersContainer=document.getElementById("numbers");
const generateBtn=document.getElementById("generateBtn");
const modeToggle=document.getElementById("modeToggle");
const actionRow=document.getElementById("actionRow");

let currentNumbers=[];

function getColor(num){
  if(num<=10) return "#facc15";
  if(num<=20) return "#3b82f6";
  if(num<=30) return "#ef4444";
  if(num<=40) return "#22c55e";
  return "#a855f7";
}

function generateNumbers(){
  const set=new Set();
  while(set.size<6){
    set.add(Math.floor(Math.random()*45)+1);
  }
  return [...set];
}

function spinBall(ball, finalNumber, duration=1200){
  return new Promise(resolve=>{
    let elapsed=0;
    const interval=60;

    const spin=setInterval(()=>{
      const randomNum=Math.floor(Math.random()*45)+1;
      ball.textContent=randomNum;
      ball.style.background=getColor(randomNum);
      elapsed+=interval;

      if(elapsed>=duration){
        clearInterval(spin);
        ball.textContent=finalNumber;
        ball.style.background=getColor(finalNumber);
        ball.classList.add("final");
        resolve();
      }
    },interval);
  });
}

async function sequentialMode(sorted){
  for(let i=0;i<6;i++){
    const ball=document.createElement("div");
    ball.className="ball";
    numbersContainer.appendChild(ball);
    await spinBall(ball,sorted[i],1000);
  }
}

async function allAtOnceMode(sorted){
  const balls=[];
  for(let i=0;i<6;i++){
    const ball=document.createElement("div");
    ball.className="ball";
    numbersContainer.appendChild(ball);
    balls.push(ball);
  }
  await Promise.all(
    balls.map((ball,i)=>spinBall(ball,sorted[i],1200))
  );
}

generateBtn.addEventListener("click", async()=>{
  generateBtn.disabled=true;
  actionRow.style.display="none";
  numbersContainer.innerHTML="";

  const numbers=generateNumbers();
  const sorted=[...numbers].sort((a,b)=>a-b);
  currentNumbers=sorted;

  if(modeToggle.checked){
    await allAtOnceMode(sorted);
  }else{
    await sequentialMode(sorted);
  }

  actionRow.style.display="flex";
  generateBtn.disabled=false;
});

/* ë³µì‚¬ */
function copyNumbers(){
  navigator.clipboard.writeText(currentNumbers.join(", "));
  alert("ë³µì‚¬ ì™„ë£Œ!");
}

/* ê³µìœ  */
function shareNumbers(){
  if(navigator.share){
    navigator.share({
      title:"ë¡œë˜ ë²ˆí˜¸",
      text:currentNumbers.join(", ")
    });
  }else{
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ê³µìœ ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }
}

/* ì´ë¯¸ì§€ ì €ì¥ (ìˆ«ì 6ê°œë§Œ) */
function saveImage(){
  const canvas=document.createElement("canvas");
  canvas.width=600;
  canvas.height=200;
  const ctx=canvas.getContext("2d");

  ctx.fillStyle="#0f172a";
  ctx.fillRect(0,0,600,200);

  currentNumbers.forEach((num,i)=>{
    ctx.beginPath();
    ctx.arc(80+i*90,100,35,0,Math.PI*2);
    ctx.fillStyle=getColor(num);
    ctx.fill();
    ctx.fillStyle="white";
    ctx.font="20px sans-serif";
    ctx.textAlign="center";
    ctx.textBaseline="middle";
    ctx.fillText(num,80+i*90,100);
  });

  const link=document.createElement("a");
  link.download="lotto.png";
  link.href=canvas.toDataURL();
  link.click();
}

let deferredPrompt;
const installBtn = document.querySelector(".install-btn");

/* ì•ˆë“œë¡œì´ë“œ ì„¤ì¹˜ ì´ë²¤íŠ¸ ê°ì§€ */
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
});

/* ë²„íŠ¼ í´ë¦­ */
installBtn.addEventListener("click", async () => {

  const ua = navigator.userAgent.toLowerCase();

  // ğŸ“± iPhone ì²˜ë¦¬
  if (ua.includes("iphone") || ua.includes("ipad")) {
    alert("ğŸ“² ì•„ì´í°ì€ Safariì—ì„œ ê³µìœ  ë²„íŠ¼ â†’ 'í™ˆ í™”ë©´ì— ì¶”ê°€'ë¥¼ ì„ íƒí•˜ì„¸ìš”.");
    return;
  }

  // ğŸ¤– ì•ˆë“œë¡œì´ë“œ
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const choiceResult = await deferredPrompt.userChoice;

    if (choiceResult.outcome === "accepted") {
      console.log("ì‚¬ìš©ìê°€ ì„¤ì¹˜ë¥¼ ìˆ˜ë½í–ˆìŠµë‹ˆë‹¤");
    }

    deferredPrompt = null;
  } else {
    alert("ì´ë¯¸ ì„¤ì¹˜ë˜ì—ˆê±°ë‚˜ ì„¤ì¹˜ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” í™˜ê²½ì…ë‹ˆë‹¤.");
  }
});

</script>

</body>
</html>
