<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Lotto Generator</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a" />

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif}

body{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:radial-gradient(circle at 20% 20%, #1e293b, #0f172a 70%);
  color:white;
  padding:20px;
}

.container{
  text-align:center;
  max-width:420px;
  width:100%;
}

h1{
  font-size:28px;
  margin-bottom:30px;
}

.numbers{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:12px;
  margin-bottom:25px;
  min-height:60px;
}

.ball{
  width:60px;
  height:60px;
  border-radius:50%;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:bold;
  font-size:18px;
  box-shadow:0 6px 18px rgba(0,0,0,0.4);
  transition:transform 0.2s;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  background:linear-gradient(135deg,#6366f1,#8b5cf6);
  color:white;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  margin-top:10px;
  transition:0.2s;
}

button:active{transform:scale(0.97)}

button:disabled{
  opacity:0.5;
  cursor:not-allowed;
}

#installBtn{
  background:linear-gradient(135deg,#10b981,#06b6d4)
}

.yellow{background:#facc15;color:#000}
.blue{background:#38bdf8}
.red{background:#ef4444}
.gray{background:#94a3b8;color:#000}
.green{background:#22c55e}

.share-row{
  display:flex;
  gap:8px;
  margin-top:10px;
}

.share-row button{
  flex:1;
  font-size:14px;
}
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ¯ Lotto Generator</h1>

  <div class="numbers" id="numbers"></div>

  <button id="generateBtn" onclick="generate()">ğŸ° ë²ˆí˜¸ ë½‘ê¸°</button>

  <div class="share-row" id="shareRow">
    <button onclick="copyNumbers()">ğŸ“‹ ë³µì‚¬</button>
    <button onclick="shareNumbers()">ğŸ“¤ ê³µìœ </button>
    <button onclick="saveImage()">ğŸ–¼ ì €ì¥</button>
  </div>

  <button id="installBtn">ğŸ“² ì•± ì„¤ì¹˜í•˜ê¸°</button>
</div>

<!-- íš¨ê³¼ìŒ -->
<audio id="tickSound">
  <source src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" type="audio/mpeg">
</audio>

<script>
const numbersContainer = document.getElementById("numbers");
const generateBtn = document.getElementById("generateBtn");
const shareRow = document.getElementById("shareRow");

function getColorClass(num){
  if(num<=10) return "yellow";
  if(num<=20) return "blue";
  if(num<=30) return "red";
  if(num<=40) return "gray";
  return "green";
}

async function generate(){

  generateBtn.disabled = true;
  shareRow.style.display = "none";
  numbersContainer.innerHTML="";

  const finalNumbers = new Set();
  while(finalNumbers.size<6){
    finalNumbers.add(Math.floor(Math.random()*45)+1);
  }
  const sorted = [...finalNumbers].sort((a,b)=>a-b);

  const balls = [];

  // ğŸ”¥ 6ê°œ ë¨¼ì € ìƒì„±
  for(let i=0;i<6;i++){
    const ball=document.createElement("div");
    ball.className="ball";
    numbersContainer.appendChild(ball);
    balls.push(ball);
  }

  await realSlotAnimation(balls, sorted);

  generateBtn.disabled = false;
  shareRow.style.display = "flex";
}

function realSlotAnimation(balls, finalNumbers){
  return new Promise(resolve=>{

    const tick = document.getElementById("tickSound");

    let duration = 2200;
    let start = null;

    function animate(timestamp){
      if(!start) start = timestamp;
      const progress = timestamp - start;
      const t = progress / duration;

      const ease = 1 - Math.pow(1 - t, 3);
      const speed = 10 + ease * 200;

      if(progress < duration){

        balls.forEach(ball=>{
          if(progress % speed < 16){
            const temp = Math.floor(Math.random()*45)+1;
            ball.textContent = temp;
            ball.className = "ball " + getColorClass(temp);
          }
        });

        requestAnimationFrame(animate);

      } else {

        // ğŸ”¥ í•œ ë²ˆì— í™•ì •
        balls.forEach((ball,index)=>{
          ball.textContent = finalNumbers[index];
          ball.className = "ball " + getColorClass(finalNumbers[index]);
          ball.style.transform = "scale(1.2)";
        });

        tick.currentTime = 0;
        tick.play().catch(()=>{});

        setTimeout(()=>{
          balls.forEach(ball=>{
            ball.style.transform = "scale(1)";
          });
          resolve();
        },200);
      }
    }

    requestAnimationFrame(animate);
  });
}

/* ë³µì‚¬ */
function copyNumbers(){
  const nums=[...document.querySelectorAll(".ball")]
    .map(el=>el.textContent)
    .join(", ");
  navigator.clipboard.writeText(nums);
  alert("ë²ˆí˜¸ ë³µì‚¬ ì™„ë£Œ âœ…");
}

/* ê³µìœ  */
function shareNumbers(){
  const nums=[...document.querySelectorAll(".ball")]
    .map(el=>el.textContent)
    .join(", ");

  if(navigator.share){
    navigator.share({
      title:"ë¡œë˜ ë²ˆí˜¸",
      text:"ğŸ¯ ë¡œë˜ ë²ˆí˜¸: "+nums
    });
  }else{
    alert("ì´ ë¸Œë¼ìš°ì €ëŠ” ê³µìœ  ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
  }
}

/* ìˆ«ì ì˜ì—­ë§Œ ì €ì¥ */
function saveImage(){
  html2canvas(document.getElementById("numbers")).then(canvas=>{
    const link=document.createElement("a");
    link.download="lotto_numbers.png";
    link.href=canvas.toDataURL();
    link.click();
  });
}

/* PWA */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}

let deferredPrompt;
const installBtn=document.getElementById("installBtn");

window.addEventListener("beforeinstallprompt",(e)=>{
  e.preventDefault();
  deferredPrompt=e;
});

installBtn.addEventListener("click",async()=>{
  if(deferredPrompt){
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt=null;
  }else{
    alert("ğŸ“± Safari â†’ ê³µìœ  â†’ í™ˆ í™”ë©´ì— ì¶”ê°€");
  }
});

generate();
</script>

</body>
</html>
